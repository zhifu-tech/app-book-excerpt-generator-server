# 更新日志

所有重要的项目变更都会记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [0.2.0] - 2025-12-09

### 🎉 重大更新

#### 架构重构

- **分层架构设计**: 从单文件应用重构为专业的分层架构
  - Controller 层：处理 HTTP 请求
  - Service 层：业务逻辑处理
  - Utils 层：通用工具函数
  - Middleware 层：Express 中间件
  - Routes 层：路由定义
- **模块化设计**: 代码按功能模块组织，职责清晰
- **易于扩展**: 新功能可以轻松添加到对应层级

#### 配置管理优化

- **统一配置管理**: 创建 `src/config/index.js` 统一管理所有配置
- **环境变量支持**: 使用 `dotenv` 管理环境变量
- **配置集中化**: 所有配置项集中管理，易于修改和维护
- **类型安全**: 配置项包含类型转换和默认值

#### 日志系统

- **结构化日志**: 实现专业的日志系统（`src/utils/logger.js`）
- **多级别日志**: 支持 error, warn, info, debug 四个级别
- **文件日志**: 自动按级别写入不同日志文件
- **JSON 格式**: 支持 JSON 格式日志，便于分析和处理
- **自动目录创建**: 自动创建日志目录

#### 错误处理

- **统一错误处理**: 创建错误处理中间件（`src/middleware/errorHandler.js`）
- **错误日志记录**: 自动记录所有错误到日志文件
- **开发环境支持**: 开发环境显示详细错误堆栈
- **404 处理**: 统一的 404 响应格式

#### 请求日志

- **请求日志中间件**: 自动记录所有 HTTP 请求
- **性能监控**: 记录请求耗时
- **状态码分类**: 根据状态码使用不同日志级别

### ✨ 新增功能

- **健康检查增强**: 健康检查端点返回运行时间信息
- **环境变量配置**: 支持通过 `.env` 文件配置所有参数
- **开发工具**: 添加 ESLint 和 Prettier 代码检查工具
- **部署脚本优化**: 部署脚本自动检测 SSH 密钥
- **Docker 优化**: 更新 Docker 配置，支持健康检查和环境变量

### 🔧 改进

- **代码质量**: 统一代码风格，添加代码检查工具
- **项目组织**: 脚本文件统一整理到 `scripts/` 目录
- **文档完善**: 更新所有文档，添加项目结构说明
- **部署流程**: 优化部署脚本，自动上传 `src/` 目录
- **端口更新**: 默认端口从 3000 更新为 3001

### 📝 文档

- **README.md**: 重写，包含完整的使用说明
- **PROJECT_STRUCTURE.md**: 新增，详细说明项目结构
- **OPTIMIZATION_SUMMARY.md**: 新增，记录优化总结
- **DOCKER.md**: 新增，Docker 部署指南
- **DEPLOY.md**: 更新，包含新的部署流程

### 🐛 修复

- **部署脚本**: 修复部署脚本未上传 `src/` 目录的问题
- **Docker 配置**: 更新端口配置和健康检查
- **路径配置**: 修复重复的 `rootDir` 变量定义

### 🔄 变更

- **项目结构**: 从单文件结构改为分层架构
- **日志系统**: 从 `console.log` 改为结构化日志系统
- **配置管理**: 从硬编码改为环境变量配置
- **错误处理**: 从简单处理改为统一中间件处理

### 📦 依赖

- **新增**: `dotenv` - 环境变量管理
- **新增**: `eslint` (dev) - 代码检查
- **新增**: `prettier` (dev) - 代码格式化

---

## [0.1.0] - 2025-12-06

### 新增

- 初始版本发布
- GET /api/config - 获取配置数据
- POST /api/config - 保存配置数据
- GET /health - 健康检查端点
- 配置数据持久化（JSON 文件）
- 配置数据验证
- CORS 支持
- Docker 支持
- 错误处理和日志记录
